<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Source Term Treatment | DISSERTATION NOTES</title>
  <meta name="description" content="My dissertation notes." />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="Source Term Treatment | DISSERTATION NOTES" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="My dissertation notes." />
  <meta name="github-repo" content="https://github.com/nucerl/dissertation-notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Source Term Treatment | DISSERTATION NOTES" />
  
  <meta name="twitter:description" content="My dissertation notes." />
  

<meta name="author" content="Erol Biçer" />


<meta name="date" content="2022-12-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="icte-derivation.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DISSERTATION NOTES</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I IATE</b></span></li>
<li class="chapter" data-level="" data-path="icte-derivation.html"><a href="icte-derivation.html"><i class="fa fa-check"></i>ICTE Derivation</a>
<ul>
<li class="chapter" data-level="" data-path="icte-derivation.html"><a href="icte-derivation.html#source-term-due-to-bubble-expansion-r"><i class="fa fa-check"></i>Source term due to Bubble Expansion, <span class="math inline">\(R\)</span></a></li>
<li class="chapter" data-level="" data-path="icte-derivation.html"><a href="icte-derivation.html#coalescence-due-to-wake-entrainment-r_we"><i class="fa fa-check"></i>Coalescence due to Wake Entrainment, <span class="math inline">\(R_{WE}\)</span></a></li>
<li class="chapter" data-level="" data-path="icte-derivation.html"><a href="icte-derivation.html#coalescence-due-to-random-collisions-r_rc"><i class="fa fa-check"></i>Coalescence due to Random Collisions, <span class="math inline">\(R_{RC}\)</span></a></li>
<li class="chapter" data-level="" data-path="icte-derivation.html"><a href="icte-derivation.html#break-up-due-to-turbulent-impact-r_ti"><i class="fa fa-check"></i>Break-up due to Turbulent Impact, <span class="math inline">\(R_{TI}\)</span></a></li>
</ul></li>
<li class="part"><span><b>II OpenFOAM</b></span></li>
<li class="chapter" data-level="" data-path="source-term-treatment.html"><a href="source-term-treatment.html"><i class="fa fa-check"></i>Source Term Treatment</a>
<ul>
<li class="chapter" data-level="" data-path="source-term-treatment.html"><a href="source-term-treatment.html#explicit-treatment-su"><i class="fa fa-check"></i>Explicit Treatment Su()</a></li>
<li class="chapter" data-level="" data-path="source-term-treatment.html"><a href="source-term-treatment.html#implicit-treatment-sp"><i class="fa fa-check"></i>Implicit Treatment Sp()</a></li>
<li class="chapter" data-level="" data-path="source-term-treatment.html"><a href="source-term-treatment.html#hybrid-treatment-susp"><i class="fa fa-check"></i>Hybrid Treatment SuSp()</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/nucerl/dissertation-notes" target="blank">See in GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DISSERTATION NOTES</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="source-term-treatment" class="section level1 unnumbered hasAnchor">
<h1>Source Term Treatment<a href="source-term-treatment.html#source-term-treatment" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The partial differential equations are converted into sets of algebraic equations through equation discretization that is usually in the form of equation <a href="icte-derivation.html#eq:1">(1)</a> where <span class="math inline">\([A]\)</span> is the sparse coefficient matrix, <span class="math inline">\([x]\)</span> is the unknown column vector, and <span class="math inline">\([b]\)</span> is the source vector. The coefficients of the algebraic equations are stored in the <span class="math inline">\([A]\)</span> matrix through the <code>fvMatrix</code> template class after the discretization.</p>
<span class="math display" id="eq:1">\[\begin{equation}
  [A][x]=[b]
  \tag{1}
\end{equation}\]</span>
<p>Source terms can be specified as Explicit, Implicit, and Implicit/Explicit (Hybrid hereinafter) through <code>Su()</code>, <code>Sp()</code>, and <code>SuSp()</code> functions, respectively, in OpenFOAM. These functions handle the incorporation of the source terms into the coefficient matrices and source term vectors. The Explicit treatment through <code>Su()</code> alters the coefficients in the source vector (i.e. <span class="math inline">\([b]\)</span>) while the Implicit treatment through <code>Sp()</code> modifies only the diagonal coefficients in the coefficient matrix (i.e. <span class="math inline">\([A]\)</span>). The Hybrid treatment automatically selects between the Implicit and Explicit treatment depending on the sign of the coefficients. The Implicit treatment is selected if the coefficients are greater than zero or the Explicit treatment is selected if the coefficients are less than zero. Though this sounds arbitrary, there is a good reason behind it which perhaps can best be explained with an example.</p>
<p>Let’s look at the steady one-dimensional heat conduction example given in <span class="citation">[<a href="#ref-Patankar2018" role="doc-biblioref">5</a>]</span> as given in equation <a href="icte-derivation.html#eq:2">(2)</a> where <span class="math inline">\(k\)</span> is the thermal conductivity, <span class="math inline">\(T\)</span> is the temperature, and <span class="math inline">\(S\)</span> is the rate of heat generation per unit volume.</p>
<span class="math display" id="eq:2">\[\begin{equation}
\frac{d}{d x}\left(k \frac{d T}{d x}\right)+S=0
\tag{2}
\end{equation}\]</span>
<p>The discretization of equation <a href="icte-derivation.html#eq:2">(2)</a> can be done after utilizing the widely used grid-point notation where P is the central node, and E and W are the neighbors. More on the notation can be found at <span class="citation">[<a href="#ref-Patankar2018" role="doc-biblioref">5</a>]</span>.</p>
<span class="math display" id="eq:3">\[\begin{equation}
\begin{aligned}
\left(k \frac{d T}{d x}\right)_e-\left(k \frac{d T}{d x}\right)_w+\int_w^e S d x &amp;=0 \\
\frac{k_e\left(T_E-T_P\right)}{(\delta x)_e}-\frac{k_w\left(T_P-T_W\right)}{(\delta x)_w}+\bar{S} \Delta x &amp;=0 \\
\end{aligned}
\tag{3}
\end{equation}\]</span>
<p>where;</p>
<span class="math display" id="eq:4">\[\begin{equation}
\bar{S}=S_C+S_P T_P
\tag{4}
\end{equation}\]</span>
<p><span class="math inline">\(\bar{S}\)</span> is the average value of source therm over the control volume which is consisted of a constant <span class="math inline">\(S_C\)</span> and a coefficient <span class="math inline">\(S_P\)</span> of the dependent variable <span class="math inline">\(T_P\)</span>. It can be seen that the <span class="math inline">\(\bar{S}\)</span> is constructed as a linear source which will be discussed more in detail later. The discretized equation <a href="icte-derivation.html#eq:3">(3)</a> can now be written in a more general format as shown in equation <a href="icte-derivation.html#eq:5">(5)</a>.</p>
<span class="math display" id="eq:5">\[\begin{equation}
a_P T_P=a_E T_E+a_W T_W+b
\tag{5}
\end{equation}\]</span>
<p>where;</p>
<span class="math display" id="eq:6">\[\begin{equation}
\begin{aligned}
a_E &amp;=\frac{k_e}{(\delta x)_e} \\
a_W &amp;=\frac{k_w}{(\delta x)_w} \\
a_P &amp;=a_E+a_W - S_P\Delta x \\
b &amp;=S_C\Delta x
\end{aligned}
\tag{6}
\end{equation}\]</span>
<p>It is known that in practical applications, the source could be dependent or independent of the dependent variable (i.e. <span class="math inline">\(T\)</span>) in the algebraic equation. This is the reason why the source is defined as it is in equation <a href="icte-derivation.html#eq:4">(4)</a>. Because the discretized equations are linear, the source term can also only have a linear dependence. However, there could be sources that are nonlinear in certain applications. Therefore, a linearization must be done to be able to incorporate the source terms into the discretized equations. This is done by iterative procedures by splitting the <span class="math inline">\(S_C\)</span> and <span class="math inline">\(S_P\)</span> parts in an intuitive way. However, the details will not be discussed here. What we are trying to understand is how this source term is incorporated into the diagonal coefficient matrix and source vector. The reasoning lay in equation <a href="icte-derivation.html#eq:6">(6)</a>.</p>
<p>In <span class="citation">[<a href="#ref-Patankar2018" role="doc-biblioref">5</a>]</span>, four basic rules were laid out to best represent the physics by the proposed procedure. Rule number 2 requires all positive coefficients meaning that the neighbors and the center-point coefficients must have the same sign. Rule number 3 is about the source term linearization. According to the rule, only a negative slope linearization is accepted. And the acceptance criterion is that the <span class="math inline">\(S_P\)</span> in equation <a href="icte-derivation.html#eq:4">(4)</a> must be <strong>always negative or equal to zero</strong> when the source term is linearized. The reasoning can be seen in equation <a href="icte-derivation.html#eq:6">(6)</a> that <span class="math inline">\(- S_P\Delta x\)</span> is added to the <span class="math inline">\(a_P\)</span> which constructs the diagonal terms of the matrix equation. Considering the diagonal dominance, which basically demands a positive (rule number 2) and large <span class="math inline">\(a_P\)</span>, it is possible to get negative values if <span class="math inline">\(S_P\)</span> is positive. Therefore, in order to ensure all positive (and large) diagonal coefficients, <span class="math inline">\(S_P\)</span> must be negative or equal to zero. As for the constant part (<span class="math inline">\(S_C\)</span>) of the source, it can be seen in <span class="math inline">\(b\)</span> in equation <a href="icte-derivation.html#eq:6">(6)</a> that it is added to the source directly as it is.</p>
<p>Considering the above explanation, now the source term treatment in OpenFOAM can be explained further. Due to the matrix operations in OpenFOAM, equation <a href="icte-derivation.html#eq:1">(1)</a> is in fact constructed as shown in equation <a href="icte-derivation.html#eq:7">(7)</a> by sending the source term to the left-hand side (LHS). This will be useful later once the individual source treatment functions are introduced.</p>
<span class="math display" id="eq:7">\[\begin{equation}
[A][x] + [-b] = 0
\tag{7}
\end{equation}\]</span>
<p>It is now possible to investigate the coded source term treatment functions; <code>Su()</code>, <code>Sp()</code>, and <code>SuSp()</code> more in detail. The source codes and the header files of the functions can be found in the <code>~\src\finiteVolume\finiteVolume\fvm</code> directory with the names <code>fvmSup.C</code> and <code>fvmSup.H</code>. It should be noted that these functions can both be utilized for <code>finiteVolumeMethod</code> (fvm::) and <code>finiteVolumeCalculus</code> (fvc::) static functions however the explanation here is based on the <code>fvm::</code> one. These functions use two arguments, for instance, Su(<span class="math inline">\(\Phi\)</span>,<span class="math inline">\(x\)</span>). The first argument <span class="math inline">\(\Phi\)</span> is the field variable of the source term and <span class="math inline">\(x\)</span> is the dependent variable of the solved equation.</p>
<div id="explicit-treatment-su" class="section level2 unnumbered hasAnchor">
<h2>Explicit Treatment Su()<a href="source-term-treatment.html#explicit-treatment-su" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first one to explore is the Explicit treatment through the <code>Su()</code> function in OpenFOAM. Snippet #1 shows how the <code>Su()</code> is implemented. Looking at line 21 of Snippet #1, one can see that <code>su.field()</code> (the first argument in the function, i.e. <span class="math inline">\(\Phi\)</span>) is subtracted from the <code>fvm.source()</code> matrix which is the <span class="math inline">\([-b]\)</span> in equation <a href="icte-derivation.html#eq:7">(7)</a>. This confirms that <code>Su()</code> is implemented in agreement with the theory.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="source-term-treatment.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb9-2"><a href="source-term-treatment.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   Foam<span class="op">::</span>tmp<span class="op">&lt;</span>Foam<span class="op">::</span>fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&gt;</span></span>
<span id="cb9-3"><a href="source-term-treatment.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   Foam<span class="op">::</span>fvm<span class="op">::</span>Su</span>
<span id="cb9-4"><a href="source-term-treatment.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">(</span></span>
<span id="cb9-5"><a href="source-term-treatment.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="at">const</span> DimensionedField<span class="op">&lt;</span>Type<span class="op">,</span> volMesh<span class="op">&gt;&amp;</span> su<span class="op">,</span></span>
<span id="cb9-6"><a href="source-term-treatment.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="at">const</span> GeometricField<span class="op">&lt;</span>Type<span class="op">,</span> fvPatchField<span class="op">,</span> volMesh<span class="op">&gt;&amp;</span> vf</span>
<span id="cb9-7"><a href="source-term-treatment.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   <span class="op">)</span></span>
<span id="cb9-8"><a href="source-term-treatment.html#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>   <span class="op">{</span></span>
<span id="cb9-9"><a href="source-term-treatment.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>       <span class="at">const</span> fvMesh<span class="op">&amp;</span> mesh <span class="op">=</span> vf<span class="op">.</span>mesh<span class="op">();</span></span>
<span id="cb9-10"><a href="source-term-treatment.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  </span>
<span id="cb9-11"><a href="source-term-treatment.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>      tmp<span class="op">&lt;</span>fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&gt;</span> tfvm</span>
<span id="cb9-12"><a href="source-term-treatment.html#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>      <span class="op">(</span></span>
<span id="cb9-13"><a href="source-term-treatment.html#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>          <span class="kw">new</span> fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;</span></span>
<span id="cb9-14"><a href="source-term-treatment.html#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>          <span class="op">(</span></span>
<span id="cb9-15"><a href="source-term-treatment.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>              vf<span class="op">,</span></span>
<span id="cb9-16"><a href="source-term-treatment.html#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>              dimVol<span class="op">*</span>su<span class="op">.</span>dimensions<span class="op">()</span></span>
<span id="cb9-17"><a href="source-term-treatment.html#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span>          <span class="op">)</span></span>
<span id="cb9-18"><a href="source-term-treatment.html#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span>      <span class="op">);</span></span>
<span id="cb9-19"><a href="source-term-treatment.html#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="dv">19</span>      fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&amp;</span> fvm <span class="op">=</span> tfvm<span class="op">.</span>ref<span class="op">();</span></span>
<span id="cb9-20"><a href="source-term-treatment.html#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span>  </span>
<span id="cb9-21"><a href="source-term-treatment.html#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span>      fvm<span class="op">.</span>source<span class="op">()</span> <span class="op">-=</span> mesh<span class="op">.</span>V<span class="op">()*</span>su<span class="op">.</span>field<span class="op">();</span></span>
<span id="cb9-22"><a href="source-term-treatment.html#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span>  </span>
<span id="cb9-23"><a href="source-term-treatment.html#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="dv">23</span>      <span class="cf">return</span> tfvm<span class="op">;</span></span>
<span id="cb9-24"><a href="source-term-treatment.html#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="dv">24</span>  <span class="op">}</span></span></code></pre></div>
<p><em>Snippet #1: The explicit source term function <code>Su()</code> in OpenFOAM</em></p>
</div>
<div id="implicit-treatment-sp" class="section level2 unnumbered hasAnchor">
<h2>Implicit Treatment Sp()<a href="source-term-treatment.html#implicit-treatment-sp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The next one to explore is the Implicit treatment through the <code>Sp()</code> function in OpenFOAM. Snippet #2 shows how the <code>Sp()</code> is implemented. Looking at line 21 of Snippet #2, one can see that <code>sp.field()</code> (the first argument in the function, i.e. <span class="math inline">\(\Phi\)</span>) is added to the <code>fvm.diag()</code> matrix which is the diagonal part of <span class="math inline">\([A]\)</span> in equation <a href="icte-derivation.html#eq:7">(7)</a>. This confirms that <code>Sp()</code> is implemented in agreement with the theory.</p>
<p>Another important difference between <code>Su()</code> and <code>Sp()</code>is the returned unit which the difference can be seen in line 16 of both Snippet #1 and #2. The reasoning can be seen in <a href="icte-derivation.html#eq:4">(4)</a> and <a href="icte-derivation.html#eq:7">(7)</a> where Sc is constant and Sp is multiplied by the dependent variable. So, this is reflected by multiplying the unit of the solved variable (the second argument in the functions, i.e. <span class="math inline">\(x\)</span>) through <code>vf.dimensions()</code> in line 16 of the Snippets.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="source-term-treatment.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb10-2"><a href="source-term-treatment.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   Foam<span class="op">::</span>tmp<span class="op">&lt;</span>Foam<span class="op">::</span>fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&gt;</span></span>
<span id="cb10-3"><a href="source-term-treatment.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   Foam<span class="op">::</span>fvm<span class="op">::</span>Sp</span>
<span id="cb10-4"><a href="source-term-treatment.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">(</span></span>
<span id="cb10-5"><a href="source-term-treatment.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="at">const</span> volScalarField<span class="op">::</span>Internal<span class="op">&amp;</span> sp<span class="op">,</span></span>
<span id="cb10-6"><a href="source-term-treatment.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="at">const</span> GeometricField<span class="op">&lt;</span>Type<span class="op">,</span> fvPatchField<span class="op">,</span> volMesh<span class="op">&gt;&amp;</span> vf</span>
<span id="cb10-7"><a href="source-term-treatment.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   <span class="op">)</span></span>
<span id="cb10-8"><a href="source-term-treatment.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>   <span class="op">{</span></span>
<span id="cb10-9"><a href="source-term-treatment.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>       <span class="at">const</span> fvMesh<span class="op">&amp;</span> mesh <span class="op">=</span> vf<span class="op">.</span>mesh<span class="op">();</span></span>
<span id="cb10-10"><a href="source-term-treatment.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  </span>
<span id="cb10-11"><a href="source-term-treatment.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>      tmp<span class="op">&lt;</span>fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&gt;</span> tfvm</span>
<span id="cb10-12"><a href="source-term-treatment.html#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>      <span class="op">(</span></span>
<span id="cb10-13"><a href="source-term-treatment.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>          <span class="kw">new</span> fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;</span></span>
<span id="cb10-14"><a href="source-term-treatment.html#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>          <span class="op">(</span></span>
<span id="cb10-15"><a href="source-term-treatment.html#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>              vf<span class="op">,</span></span>
<span id="cb10-16"><a href="source-term-treatment.html#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>              dimVol<span class="op">*</span>sp<span class="op">.</span>dimensions<span class="op">()*</span>vf<span class="op">.</span>dimensions<span class="op">()</span></span>
<span id="cb10-17"><a href="source-term-treatment.html#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span>          <span class="op">)</span></span>
<span id="cb10-18"><a href="source-term-treatment.html#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span>      <span class="op">);</span></span>
<span id="cb10-19"><a href="source-term-treatment.html#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="dv">19</span>      fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&amp;</span> fvm <span class="op">=</span> tfvm<span class="op">.</span>ref<span class="op">();</span></span>
<span id="cb10-20"><a href="source-term-treatment.html#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span>  </span>
<span id="cb10-21"><a href="source-term-treatment.html#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span>      fvm<span class="op">.</span>diag<span class="op">()</span> <span class="op">+=</span> mesh<span class="op">.</span>V<span class="op">()*</span>sp<span class="op">.</span>field<span class="op">();</span></span>
<span id="cb10-22"><a href="source-term-treatment.html#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span>  </span>
<span id="cb10-23"><a href="source-term-treatment.html#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="dv">23</span>      <span class="cf">return</span> tfvm<span class="op">;</span></span>
<span id="cb10-24"><a href="source-term-treatment.html#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="dv">24</span>  <span class="op">}</span></span></code></pre></div>
<p><em>Snippet #2: The explicit source term function <code>Sp()</code> in OpenFOAM</em></p>
</div>
<div id="hybrid-treatment-susp" class="section level2 unnumbered hasAnchor">
<h2>Hybrid Treatment SuSp()<a href="source-term-treatment.html#hybrid-treatment-susp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The last one to explore is the Hybrid treatment through the <code>SuSp()</code> function in OpenFOAM. Snippet #3 shows how the <code>SuSp()</code> is implemented. Looking at lines 21 through 24 of Snippet #3, one can see that <code>susp.field()</code> (the first argument in the function, i.e. <span class="math inline">\(\Phi\)</span>) is either subtracted from <code>fvm.source()</code> matrix which is the <span class="math inline">\([-b]\)</span> or added to the <code>fvm.diag()</code> matrix which is the diagonal part of <span class="math inline">\([A]\)</span> in equation <a href="icte-derivation.html#eq:7">(7)</a>. This confirms that <code>SuSp()</code> is implemented in agreement with the theory.</p>
<p>It would be useful to go through the selective logic in the code to understand how the code decides whether it is implicit or explicit. Let’s think of a positive <code>susp.field()</code> (the first argument in the function, i.e. <span class="math inline">\(\Phi\)</span>), first in line 21, the code compares it with scalar zero and selects the maximum. Since it’s positive, the <code>susp.field()</code> is selected and multiplied by the volume and added to the diagonal coefficient matrix. It continues to line 23, and compares a positive <code>susp.field()</code> with a scalar zero to select the minimum. Of course, zero is selected and then multiplied by volume. Therefore no changes are done to the source matrix. The reverse can also be thought for a negative <code>susp.field()</code>. This time zero is selected for the diagonal matrix hence no changes are made to it however a negative <code>susp.field()</code> is selected for the source matrix, multiplied with the dependent variable and subtracted from itself. So, in short, it can be said that if the first argument of the <code>SuSp()</code> function is positive the function directly changes the diagonals of the coefficient matrix, and if it is negative then it is multiplied with the independent variable, and changes the source coefficients.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="source-term-treatment.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="kw">template</span><span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb11-2"><a href="source-term-treatment.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   Foam<span class="op">::</span>tmp<span class="op">&lt;</span>Foam<span class="op">::</span>fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&gt;</span></span>
<span id="cb11-3"><a href="source-term-treatment.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   Foam<span class="op">::</span>fvm<span class="op">::</span>SuSp</span>
<span id="cb11-4"><a href="source-term-treatment.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">(</span></span>
<span id="cb11-5"><a href="source-term-treatment.html#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="at">const</span> volScalarField<span class="op">::</span>Internal<span class="op">&amp;</span> susp<span class="op">,</span></span>
<span id="cb11-6"><a href="source-term-treatment.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="at">const</span> GeometricField<span class="op">&lt;</span>Type<span class="op">,</span> fvPatchField<span class="op">,</span> volMesh<span class="op">&gt;&amp;</span> vf</span>
<span id="cb11-7"><a href="source-term-treatment.html#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   <span class="op">)</span></span>
<span id="cb11-8"><a href="source-term-treatment.html#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>   <span class="op">{</span></span>
<span id="cb11-9"><a href="source-term-treatment.html#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>       <span class="at">const</span> fvMesh<span class="op">&amp;</span> mesh <span class="op">=</span> vf<span class="op">.</span>mesh<span class="op">();</span></span>
<span id="cb11-10"><a href="source-term-treatment.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  </span>
<span id="cb11-11"><a href="source-term-treatment.html#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>      tmp<span class="op">&lt;</span>fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&gt;</span> tfvm</span>
<span id="cb11-12"><a href="source-term-treatment.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>      <span class="op">(</span></span>
<span id="cb11-13"><a href="source-term-treatment.html#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>          <span class="kw">new</span> fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;</span></span>
<span id="cb11-14"><a href="source-term-treatment.html#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>          <span class="op">(</span></span>
<span id="cb11-15"><a href="source-term-treatment.html#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>              vf<span class="op">,</span></span>
<span id="cb11-16"><a href="source-term-treatment.html#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>              dimVol<span class="op">*</span>susp<span class="op">.</span>dimensions<span class="op">()*</span>vf<span class="op">.</span>dimensions<span class="op">()</span></span>
<span id="cb11-17"><a href="source-term-treatment.html#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span>          <span class="op">)</span></span>
<span id="cb11-18"><a href="source-term-treatment.html#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span>      <span class="op">);</span></span>
<span id="cb11-19"><a href="source-term-treatment.html#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="dv">19</span>      fvMatrix<span class="op">&lt;</span>Type<span class="op">&gt;&amp;</span> fvm <span class="op">=</span> tfvm<span class="op">.</span>ref<span class="op">();</span></span>
<span id="cb11-20"><a href="source-term-treatment.html#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span>  </span>
<span id="cb11-21"><a href="source-term-treatment.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="dv">21</span>      fvm<span class="op">.</span>diag<span class="op">()</span> <span class="op">+=</span> mesh<span class="op">.</span>V<span class="op">()*</span>max<span class="op">(</span>susp<span class="op">.</span>field<span class="op">(),</span> scalar<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span>
<span id="cb11-22"><a href="source-term-treatment.html#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span>  </span>
<span id="cb11-23"><a href="source-term-treatment.html#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="dv">23</span>      fvm<span class="op">.</span>source<span class="op">()</span> <span class="op">-=</span> mesh<span class="op">.</span>V<span class="op">()*</span>min<span class="op">(</span>susp<span class="op">.</span>field<span class="op">(),</span> scalar<span class="op">(</span><span class="dv">0</span><span class="op">))</span></span>
<span id="cb11-24"><a href="source-term-treatment.html#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="dv">24</span>          <span class="op">*</span>vf<span class="op">.</span>primitiveField<span class="op">();</span></span>
<span id="cb11-25"><a href="source-term-treatment.html#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span>  </span>
<span id="cb11-26"><a href="source-term-treatment.html#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="dv">26</span>      <span class="cf">return</span> tfvm<span class="op">;</span></span>
<span id="cb11-27"><a href="source-term-treatment.html#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="dv">27</span>  <span class="op">}</span></span></code></pre></div>
<p><em>Snippet #3: The hybrid source term function <code>SuSp()</code> in OpenFOAM</em></p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-Patankar2018" class="csl-entry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Patankar SV (2018) <a href="https://doi.org/10.1201/9781482234213">Numerical heat transfer and fluid flow</a>. <span>CRC</span> Press</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="icte-derivation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nucerl/dissertation-notes/edit/main/01-OpenFOAM.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
